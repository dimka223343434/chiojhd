<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ø—Ä–∏–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #272e35;
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .chat-header {
      background-color: #2a9d8f;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }

    .chat-body {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      background-color: #1e2931;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 70%;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
      word-wrap: break-word;
      font-size: 16px;
      transition: transform 0.3s ease;
    }

    .bot {
      align-self: flex-start;
      background-color: #374151;
    }

    .user {
      align-self: flex-end;
      background-color: #1da1f2;
    }

    .chat-footer {
      background-color: #2a9d8f;
      padding: 10px;
      display: flex;
      align-items: center;
    }

    .chat-footer input {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 5px;
      outline: none;
      font-size: 16px;
    }

    .chat-footer button {
      margin-left: 10px;
      background-color: #1da1f2;
      border: none;
      padding: 12px 16px;
      border-radius: 5px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    video, audio {
      width: 100%;
      max-width: 100%;
      margin: 10px 0;
    }

    .choice, .shop, .theme-toggle {
      text-align: center;
      margin-top: 20px;
    }

    .choice button, .shop button, .theme-toggle button {
      margin: 5px;
      padding: 12px 20px;
      background-color: #1da1f2;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .points {
      text-align: center;
      margin: 10px;
      font-size: 18px;
    }

    .secret-message {
      animation: flash 1s infinite;
    }

    @keyframes flash {
      0% { background-color: yellow; color: black; }
      100% { background-color: #374151; color: white; }
    }

    .light-mode {
      background-color: #f1f5f9;
      color: black;
    }

    .light-mode .chat-body {
      background-color: #f9fafb;
    }

    .light-mode .message.bot {
      background-color: #cbd5e1;
    }

    .light-mode .message.user {
      background-color: #3b82f6;
    }

    .light-mode .chat-footer,
    .light-mode .chat-header {
      background-color: #64748b;
      color: white;
    }

    .light-mode .chat-footer input {
      background-color: #e2e8f0;
    }
  </style>
</head>
<body>

  <!-- –®–∞–ø–∫–∞ —á–∞—Ç–∞ -->
  <div class="chat-header">–ß–∞—Ç —Å –Ø—Ä–∏–∫–æ–º</div>

  <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
  <div class="theme-toggle">
    <button onclick="toggleTheme()">üåô –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
  </div>

  <!-- –¢–µ–ª–æ —á–∞—Ç–∞ -->
  <div class="chat-body" id="chat">
    <div class="message bot">–ü—Ä–∏–≤–µ—Ç –¥–∞–≤–∞–π –≥—É–ª—è—Ç—å</div>
  </div>

  <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <form class="chat-footer" id="chat-form">
    <input type="text" id="input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off" />
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  <!-- –í–∏–¥–µ–æ -->
  <div id="video-container"></div>

  <!-- –í—ã–±–æ—Ä -->
  <div id="choice-container" class="choice" style="display: none;">
    <p>–í—ã—Ç–∞—â–∏—Ç—å –Ø—Ä–∏–∫–∞ –∏–∑ –∫–∞–Ω–∞–≤—ã?</p>
    <button onclick="chooseYes()">–î–∞</button>
    <button onclick="chooseNo()">–ù–µ—Ç</button>
  </div>

  <!-- –ú–∞–≥–∞–∑–∏–Ω -->
  <div id="shop-container" class="shop" style="display: none;">
    <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
    <p id="points-display">–û—á–∫–∏: 0</p>
    <button onclick="buySong()">–ö—É–ø–∏—Ç—å –ø–µ—Å–Ω—é –∑–∞ 100 –æ—á–∫–æ–≤</button>
    <div id="music-controls" style="margin-top: 20px; display: none;">
      <audio id="song-player" controls></audio><br>
      <button onclick="playSong()">‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
      <button onclick="pauseSong()">‚è∏ –ü–∞—É–∑–∞</button>
    </div>
  </div>

  <!-- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
  <div id="secret-music" style="display: none; text-align: center; margin-top: 20px;">
    <button onclick="playSecretSong()">üéµ –°–µ–∫—Ä–µ—Ç–Ω–∞—è –ø–µ—Å–Ω—è</button>
    <audio id="secret-song-player" src="audio/secret.mp3"></audio>
  </div>

  <!-- –ú–µ–º—ã -->
  <div id="meme-container"></div>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('input');

    const videoContainer = document.getElementById('video-container');
    const choiceContainer = document.getElementById('choice-container');
    const shopContainer = document.getElementById('shop-container');
    const pointsDisplay = document.getElementById('points-display');
    const songPlayer = document.getElementById('song-player');
    const musicControls = document.getElementById('music-controls');
    const secretMusic = document.getElementById('secret-music');
    const memeContainer = document.getElementById('meme-container');

    // –ü—É—Ç–∏ –∫ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞–º
    const videos = {
      "–ß—É–ø–∞—á—É–ø—Å": "video/chupa.mp4",
      "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞": "video/s.mp4",
      "Klava": "video/klava.mp4",
      "No": "video/no.mp4",
      "Mama": "video/mama.mp4"
    };

    // –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –ø–µ—Å–Ω–µ
    const LOCAL_SONG_URL = "audio/b.mp3";
    const LOCAL_SECRET_SONG_URL = "audio/secret.mp3";

    let firstBotMessage = false;
    let finalPhase = false;

    // –ò–≥—Ä–∞
    let points = parseInt(localStorage.getItem("points")) || 0;
    let level = parseInt(localStorage.getItem("level")) || 1;
    let messageCount = parseInt(localStorage.getItem("messages")) || 0;

    function updatePointsDisplay() {
      pointsDisplay.textContent = "–û—á–∫–∏: " + points;
    }

    function addMessage(text, sender) {
      const msg = document.createElement('div');
      msg.className = 'message ' + sender;
      msg.textContent = text;
      if (text === "–≥–æ –≥—É–ª—è—Ç—å —è —Ö–∞—á—É") {
        msg.classList.add("secret-message");
        secretMusic.style.display = 'block';
      }
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    window.onload = () => {
      setTimeout(() => {
        addMessage("–ü—Ä–∏–≤–µ—Ç –¥–∞–≤–∞–π –≥—É–ª—è—Ç—å", 'bot');
      }, 500);
      updatePointsDisplay();
    };

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const text = input.value.trim().toLowerCase();
      if (!text) return;

      addMessage(text, 'user');
      messageCount++;
      localStorage.setItem("messages", messageCount);

      // –ü–æ–¥–∞—Ä–∫–∏ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
      points += 1;
      localStorage.setItem("points", points);
      updatePointsDisplay();

      if (finalPhase && text === '–≥–æ') {
        showVideo("Mama");
        input.value = '';
        return;
      }

      setTimeout(() => {
        // –†–∞–Ω–¥–æ–º–Ω—ã–µ —à—É—Ç–∫–∏
        const randomReplies = ["—è –≥–µ–π", "–≥–¥–µ –º–æ–π —á—É–ø–∞—á—É–ø—Å?", "—á—ë –º–æ–ª—á–∏—à—å?", "—è –Ω–µ –≥–µ–π"];
        const reply = Math.random() < 0.3 ? randomReplies[Math.floor(Math.random() * randomReplies.length)] : "";

        if (text === '–≥–æ') {
          if (!firstBotMessage) {
            addMessage("–©–∞—Å —è —á—É–ø–∞—á—É–ø—Å –ø–æ—Å–æ—Å—É", 'bot');
            setTimeout(() => showVideo("–ß—É–ø–∞—á—É–ø—Å"), 5000);
            firstBotMessage = true;
          } else {
            addMessage(reply || "—è –≥–µ–π", 'bot');
          }
        } else if (text === '—Ç—ã –≥–µ–π') {
          addMessage("–Ø –Ω–µ –≥–µ–π, –¥–∞–≤–∞–π –≥—É–ª—è—Ç—å", 'bot');
        } else if (text === '–∏–¥–∏ –≤ –∂–æ–ø—É –µ–≤—Ä–µ–π') {
          addMessage("–¥–∞–≤–∞–π –¥–µ–ª–∞—Ç—å –≤–º–µ—Å—Ç–µ –±–∞–±—É–ª—é", 'bot');
        } else if (text === '—Å–µ–∫—Ä–µ—Ç') {
          addMessage("–°–µ–∫—Ä–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!", 'bot');
          secretMusic.style.display = 'block';
        } else if (text === '—Ç—ã –ª–µ–≥–µ–Ω–¥–∞') {
          addMessage("–¢—ã —Ä–µ–∞–ª—å–Ω–æ –ª–µ–≥–µ–Ω–¥–∞, –±—Ä–∞—Ç", 'bot');
        } else if (text === '–ø–∞—Å—Ö–∞–ª–∫–∞') {
          addMessage("–≠—Ç–æ –ø–∞—Å—Ö–∞–ª–∫–∞! üê£", 'bot');
        } else if (text === '–≥–æ'.repeat(5)) {
          addMessage("–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +100 –æ—á–∫–æ–≤", 'bot');
          points += 100;
          localStorage.setItem("points", points);
          updatePointsDisplay();
        } else {
          addMessage(reply || "—è –≥–µ–π", 'bot');
        }

        // –ú–µ–º—ã
        if (messageCount % 5 === 0) {
          const meme = document.createElement('img');
          meme.src = "memes/meme1.jpg"; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –ø—É—Ç—å
          meme.style.width = "100%";
          meme.style.maxWidth = "300px";
          meme.style.marginTop = "10px";
          memeContainer.innerHTML = "";
          memeContainer.appendChild(meme);
        }
      }, 500);

      input.value = '';
    });

    function showVideo(videoName) {
      const videoPath = videos[videoName];
      if (!videoPath) return;

      const video = document.createElement('video');
      video.src = videoPath;
      video.controls = true;
      video.autoplay = true;
      video.muted = false;

      videoContainer.innerHTML = '';
      videoContainer.appendChild(video);
      videoContainer.style.display = 'block';

      video.addEventListener('ended', () => {
        videoContainer.style.display = 'none';

        if (videoName === "–ß—É–ø–∞—á—É–ø—Å") {
          showVideo("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞");
        } else if (videoName === "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞") {
          choiceContainer.style.display = 'block';
        } else if (videoName === "Klava") {
          shopContainer.style.display = 'block';
          points += 100;
          localStorage.setItem("points", points);
          updatePointsDisplay();
        } else if (videoName === "No") {
          endGameSequence();
        } else if (videoName === "Mama") {
          addMessage("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!", 'bot');
          setTimeout(() => {
            try {
              window.close();
            } catch (e) {
              alert('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!');
            }
          }, 2000);
        }
      });
    }

    function endGameSequence() {
      setTimeout(() => {
        addMessage("–≥–æ –≥—É–ª—è—Ç—å —è —Ö–∞—á—É", 'bot');
        finalPhase = true;
      }, 500);
    }

    function chooseYes() {
      choiceContainer.style.display = 'none';
      showVideo("Klava");
    }

    function chooseNo() {
      choiceContainer.style.display = 'none';
      showVideo("No");
    }

    function buySong() {
      if (points >= 100) {
        points -= 100;
        localStorage.setItem("points", points);
        updatePointsDisplay();

        songPlayer.src = LOCAL_SONG_URL;
        songPlayer.load();
        musicControls.style.display = 'block';

        songPlayer.play().catch(() =>
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏. –ù–∞–∂–º–∏—Ç–µ ‚ñ∂Ô∏è –≤—Ä—É—á–Ω—É—é.")
        );
      } else {
        alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ—á–∫–æ–≤!");
      }
    }

    function playSong() {
      songPlayer.play();
    }

    function pauseSong() {
      songPlayer.pause();
    }

    function playSecretSong() {
      const player = document.getElementById('secret-song-player');
      player.src = LOCAL_SECRET_SONG_URL;
      player.play();
    }

    function toggleTheme() {
      document.body.classList.toggle("light-mode");
    }
  </script>
</body>
</html>